{% extends "base.html" %}

{% block content %}
<main class="film-list-page">
    <div class="container">
        <div class="page-header">
            <h1>{{ _('Movie List') }}</h1>
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('film.recommendations') }}" class="btn btn-primary">{{ _('View My Recommendations') }}</a>
            {% endif %}
        </div>

        <!-- Sorted by popularity only, filters/search removed -->

        <!-- Movie grid -->
        {% if films %}
        <div class="films-grid">
            {% for film in films %}
            <div class="film-card" data-href="{{ url_for('film.film_detail', film_id=film.id) }}">
                <div class="film-poster">
                    {% if film.poster_url %}
                        {% if film.poster_url.startswith('http') or film.poster_url.startswith('//') %}
                        <img src="{{ film.poster_url }}" alt="{{ film.title }} poster">
                        {% else %}
                            <img src="{{ url_for('static', filename='posters/' ~ film.poster_url) }}" alt="{{ film.title }} poster">
                        {% endif %}
                    {% else %}
                        <div class="no-poster">{{ _('No poster') }}</div>
                    {% endif %}
                </div>
                <div class="film-info">
                    <h3><a href="{{ url_for('film.film_detail', film_id=film.id) }}">{{ film.title }}</a></h3>
                    <p class="film-meta">
                        {% if film.year %}{{ film.year }} · {% endif %}
                        {% if film.director %}{{ film.director }} · {% endif %}
                        {% if film.genre %}{{ film.genre }}{% endif %}
                    </p>
                    {% if (film.average_rating or 0) > 0 %}
                        <div class="rating">
                            <span class="stars">★</span>
                            <span class="rating-value">{{ "%.1f"|format(film.average_rating) }}</span>
                        </div>
                    {% endif %}
                    <p class="likes">{{ film.like_count }} likes</p>
                    <div class="list-actions" style="margin-top:8px;">
                        {% set liked = (current_user.is_authenticated and film.id in liked_ids) %}
                        <button class="btn btn-outline like-btn {% if liked %}liked{% endif %}" data-film-id="{{ film.id }}" aria-pressed="{{ 'true' if liked else 'false' }}">
                            <i class="fas fa-heart"></i> {% if liked %}{{ _('Unlike') }}{% else %}{{ _('Like') }}{% endif %}
                        </button>
                        <span data-like-count="{{ film.id }}" style="margin-left:8px;">{{ film.like_count }}</span>
                    </div>
                    {% if film.description %}
                        <p class="description">{{ film.description[:100] }}{% if film.description|length > 100 %}...{% endif %}</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if total > per_page %}
        <div class="pagination">
            {% set total_pages = (total + per_page - 1) // per_page %}
            {% if page > 1 %}
                <a href="{{ url_for('film.list_films', page=page-1) }}" class="page-link">Previous</a>
            {% endif %}

            {% set start_page = page-2 if page-2 > 0 else 1 %}
            {% set end_page = page+3 if page+3 < total_pages+1 else total_pages+1 %}
            {% for page_num in range(start_page, end_page) %}
                {% if page_num == page %}
                    <span class="page-link current">{{ page_num }}</span>
                {% else %}
                    <a href="{{ url_for('film.list_films', page=page_num) }}" class="page-link">{{ page_num }}</a>
                {% endif %}
            {% endfor %}

            {% if page < total_pages %}
                <a href="{{ url_for('film.list_films', page=page+1) }}" class="page-link">Next</a>
            {% endif %}
        </div>
        {% endif %}

        {% else %}
        <div class="no-results">
            <h3>No movies found matching your criteria</h3>
            <p>Please try adjusting your filter conditions</p>
            <a href="{{ url_for('film.list_films') }}" class="btn btn-primary">Clear Filters</a>
        </div>
        {% endif %}
    </div>
</main>
{% endblock %}
